

# **泊松回归模型**

**当通过一系列连续型和或类别型预测变量来预测计数型结果变量时，泊松回归是一个非常有用的工具。**

➢ 为阐述泊松回归模型的拟合过程，并探讨一些可能出现的问题，我们使用robust
程辑包中的Breslow癫痫数据集（Breslow, 1993）。特别地，我们将讨论在治疗
初期的8周内，抗癫痫药物对癫痫发病数的影响。请提前安装robust包。

➢ 我们就遭受轻微或严重间歇性癫痫的病人的年龄和癫痫发病数收集了数据，包含
病人被随机分配到药物组或者安慰剂组前8周和随机分配后8周两种情况。响应变
量为sumY（随机化后8周内癫痫发病数），预测变量为治疗条件（Trt）、年龄
（Age）和前8周内的基础癫痫发病数

➢ 之所以包含基础癫病发病数和年龄是因为它们对响应变量有潜在影响。在解释这些变量后，我们感兴趣的是药物治疗是否能减少癫病发病数

➢ 首先， 看看数据集的统计汇总信息

```{r,message=FALSE}
library(robust)
# look at dataset
data(breslow.dat, package="robust")
names(breslow.dat)
summary(breslow.dat[c(6, 7, 8, 10)])
```

注意，虽然数据集有 12 变量，但是我们只关注之前描述的四个变量。 基础和随机化后的癫痫病发病数都有很高的偏度。 

现在，我们通过绘制图形更详细地考察响应变量：

```{r}
# plot distribution of post-treatment seizure counts
opar <- par(no.readonly=TRUE)
par(mfrow=c(1, 2))
attach(breslow.dat)
hist(sumY, breaks=20, xlab="Seizure Count",
     main="Distribution of Seizures")
boxplot(sumY ~ Trt, xlab="Treatment", main="Group Comparisons")
par(opar)
```


从上图中我们可以清楚的看到因变量的便宜特性及可能的离群点。初看图形时，药物治疗下癫痫的发病数似乎变小了，且方差也变小了（泊松回归中，较小的方差伴随着较小的均值）。与标准最小二乘回归不同，泊松回归并不关注方差异质性。

## 拟合泊松回归

```{r}
# fit regression
fit <- glm(sumY ~ Base + Age + Trt, data=breslow.dat, family=poisson())
summary(fit)
```


输出结果列出了偏差、回归系数、标准误和参数为0的检验。此处预测变量在 p<0.05的水平下都非常显著。

## 解释模型参数

```{r}
coef(fit)
```

在泊松回归中，因变量以条件均值的对数形式 $\log (\lambda)$ 来建模. 
年龄的回归参数为0.0227,
表明保持其他预测变量不变，年龄增加一岁，癫痫病发病数的对数均值将相应增加0.03。截距项即当
预测变量都为0时，癫病发病数的对数均值。由于不可能为0岁，且调查对象的基础癫痫病发病数均不为0, 因此本例中截距项没有意义。

通常在因变量的初始尺度（癫病发病数，而非发病数的对数）上解释回归系数比较容易。因此，指数化系数：

```{r}
exp(coef(fit))
```

现在可以看到，保持其他变量不变，年龄增加一岁，期望的癫病发病数将乘以 1.023。这意味着年龄的增加与较高的癫痫病发病数相关联。更为重要的是，一单位Trt的变化（即从安慰剂到治疗组），期望的癫痫病发病数将乘以 0.86,也就是说，保持基础癫痫病发病数和年龄不变，服药组相对于安慰剂组癫痫病发病数降低了20%。

另外需要牢记的是，与Logisic回归中的指数化参数相似，泊松模型中的指数参数对响应变量的影响都是成倍增加的．而不是线性相加。 同样，你还需要评价泊松模型的过度离势。

## 过度离势

泊松分布的方差和均值相等。当响应变量观测的方差比依据泊松分布预测的方差大时，泊松回归可能发生过度离势。处理计数型数据时经常发生过度离势，且过度离势会对结果的可解释性造成负面影响，因此我们需要花些时间讨论该问题。

可能发生过度离势的原因有如下几个：

- 遗漏了某个重要的预测变量

- 可能因为**事件相关** 。
在泊松分布的观测中，计数中每次事件都被认为是独立发生的。
以癫痫病数据为例，这意味着对于任何病人，每次癫痫病发病的概率与其他癫痫病发病的概率相互独立。但是这个假设通常都无法满足。对于某个病人，在已知他已经发生了 39 次癫痫时，第一次发生癫痫的概率不可能与第40次发生癫痫的概率相同。

- 在纵向数据分析中，重复测量的数据由于内在群聚特性可导致过度离势。 此处并不讨论纵向泊松模型。

如果存在过度离势，在模型中你无法进行解释，那么可能会得到很小的标准误和置信区间，并且显著性检验也过于宽松（也就是说，你将会发现并不真实存在的效应）

与Logistic 回归类似，此处如果残差偏差与残差自由度的比例远远大于1，那么表明存在过度离势。对于癫痫病数据，它的比例为：

```{r,collapse=TRUE}
deviance(fit)/df.residual(fit)
```

很显然，比例远远大于1。

qcc包提供了一个对泊松模型过度离势的检验方法 （在首次使用前，请确保巳经下载和安装此包）如下代码可进行癫痫病数据过度离势的检验：

```{r,message=FALSE}
library(qcc)
qcc.overdispersion.test(breslow.dat$sumY, type="poisson")
```


意料之中，显著性检验的p值果然小于0.05, 进一步表明确实存在过度离势。

通过用`famly="quasipoisson"` 替换 `family="poisson"`, 你仍然可以使用`glm()` 函数
对该数据进行拟合。这与Logistic回归处理过度离势的方法是相同的。

```{r}
fit.od <- glm(sumY ~ Base + Age + Trt, data=breslow.dat,
              family=quasipoisson())
summary(fit.od)
```


注意．使用类泊松(quasi-Poisson)方法所得的参数估计与泊松方法相同，但标准误变大了许多。此处，标准误越大将会导致Trt (和Age) 的p值越大于0.05。 
当考虑过度离势，并控制基础癫痫病数和年龄时，并没有充足的证据表明药物治疗相对于使用安慰剂能显著降低癫痫病的发病次数。

不过请记住，本例只是用于阐释泊松模型，它的结果并不能用来反映真实世界中的普罗加比（治疗癫病）药效问题。

注：*本章内容来自《R语言实战》第13章第3节泊松回归*




